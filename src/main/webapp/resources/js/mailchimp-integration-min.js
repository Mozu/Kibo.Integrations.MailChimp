$(document).ready(function(){$("#secondTab").hide(),$("#thirdTab").hide(),$("#fourthTab").hide();var t="true";$(".configureEditMailchimpTxt").each(function(){""!=$(this).val()&&(t=$(this).val())}),"true"!=t&&($("#secondTab").show(),$("#thirdTab").show(),$("#fourthTab").show(),$("#listMapConfDiv").show(),getListSiteDD()),$(".configureEditMailchimpTxt").each(function(){$(this).change(function(){(""==$(this).val()||null==$(this).val())&&alert("api key can not be blank")})}),$("#firstTab").click(function(){activateContentPane(this)}),$("#secondTab").click(function(){var t={tenantId:$("#tenantIdHdn").val()},a="getMailchimpSettings";activateContentPane(this),getSyncTab(t,a)}),$("#thirdTab").click(function(){activateContentPane(this),getJobHistory()}),$("#fourthTab").click(function(){var t={tenantId:$("#tenantIdHdn").val()},a="getCampaigns";activateContentPane(this),getDiscountTab(t,a)}),$("#viewMapping").click(function(){getMappedData()}),$("#createBatchEntry").click(function(t){t.preventDefault();var a=""+$("#tenantIdHdn").val()+":"+$("#mcDirectionDD").val()+":"+$("#mcListId").val();$.ajax({headers:{"Content-Type":"application/javascript"},url:"saveBatchEntry?batchEntryParam="+a,type:"POST",data:a,success:function(t){"SUCCESS"==t?$("#batchSaveSuccess").show():$("#batchSaveError").show()},error:function(){$("#content").hide()}})}),$(".configureEditMailchimpBtn").click(function(t){t.preventDefault(),$(".configureEditMailchimpTxt").each(function(){$(this).parent().toggle()})}),$("#btnConnect").click(function(t){t.preventDefault(),$("#secondTab").click()}),$(".saveApikeyBtn").click(function(t){t.preventDefault(),$("#loaderImg").show(),$("#invalidApiKey2").hide(),$("#invalidApiKey1").hide(),$.ajax({headers:{"Content-Type":"application/javascript"},url:"saveMailchimpKey?tenantParam="+$("#tenantIdHdn").val()+":"+$(".configureEditMailchimpTxt").val()+":"+$("#mapSiteId1").val()+":"+$("#mapListId1").val(),type:"GET",success:function(t){"SUCCESS"==t?($("#successSaveApikey").parent().parent().show(),getListSiteDD(),getMappedData()):($("#invalidApiKey2").parent().parent().show(),$("#invalidApiKey1").parent().parent().show())},error:function(){$("#content").hide()}})}),$("#firstTab").css("color","#D74536"),$("#saveDiscount").click(function(t){t.preventDefault();var a=""+$("#tenantIdHdn").val()+":"+$("#mcCampaignList").val()+":"+$("#mcDiscountList").val();$.ajax({headers:{"Content-Type":"application/javascript"},url:"saveDiscountMapping?discountParam="+a,type:"POST",data:a,success:function(t){"SUCCESS"==t?$("#discountSaveSuccess").show():$("#discountSaveError").show()},error:function(){$("#content").hide()}})}),$("#addDiscountSoft").click(function(t){t.preventDefault();var a=$("<tr/>");a.attr("class","tempRows");var n=$("<td/>"),e=$("<p/>");$(e).html($("#mcCampaignList option:selected").text()),$(n).append(e),$(a).append(n);var i=$("<td/>"),c=$("<p/>");$(c).html($("#mcDiscountList option:selected").text()),$(i).append(c),$(a).append(i),$("#addDiscountAjaxBody").append(a)})});function getJobHistory(){$(".tempRows").each(function(){$(this).remove()});var t=""+$("#tenantIdHdn").val();$.ajax({headers:{"Content-Type":"application/javascript"},url:"getJobHistory?tenantId="+t,type:"GET",success:function(t){var a=t.historyData.substring(1,t.historyData.length-1),e=$.parseJSON(a),n=e.batchModelList,i=0;$.each(n,function(t,a){i+=1;var e=$("<tr/>");e.attr("class","tempRows");var n=$("<td/>"),s=$("<p/>");$(s).html(i),$(n).append(s),$(e).append(n);var c=$("<td/>"),o=$("<p/>");$(o).html(a.syncDirection),$(c).append(o),$(e).append(c);var p=$("<td/>"),r=$("<p/>");$(r).html(a.batchStatus),$(p).append(r),$(e).append(p);var d=$("<td/>"),h=$("<p/>");$(h).html(a.createdDate),$(d).append(h),$(e).append(d);var l=$("<td/>"),u=$("<p/>");$(u).html(a.errorMsg),$(l).append(u),$(e).append(l);var v=$("<td/>"),m=$("<a/>");"FAILED"==a.batchStatus&&($(m).attr("id",i),$(m).attr("class","reAssign"),$(m).html("Re-Process"),$(m).attr("onclick","javascript:rescheduleBatch("+a.batchId+")"),$(v).append(m)),$(e).append(v),$("#dummyRow").remove(),$("#historyBody").append(e)}),$("#historyTable").dataTable().fnDraw()},error:function(){$("#content").hide()}})}function getSyncTab(t,a){$("#invalidApiKey2").hide(),$("#invalidApiKey1").hide(),$.ajax({headers:{"Content-Type":"application/javascript"},url:a,type:"GET",data:t,success:function(t){if("SUCCESS"==t.status){$("#mcListId").children().each(function(){$(this).remove()}),$("#mcSyncJobSetupTabBack").hide(),$("#mcSyncJobSetupTabMain").show();var a=t.ddList;$.each(a,function(t,a){var e="<option value="+a.value+">"+a.text+"</option>";$(e).appendTo("#mcListId")})}else $("#mcSyncJobSetupTabBack").show(),$("#mcSyncJobSetupTabMain").hide(),$("#invalidApiKey2").show(),$("#invalidApiKey1").show(),$("#loaderImg").hide()},error:function(){$("#content").hide()}})}function getDiscountTab(t,a){$.ajax({headers:{"Content-Type":"application/javascript"},url:a,type:"GET",data:t,success:function(t){if("SUCCESS"==t.status){var a=t.campaignDD.substring(1,t.campaignDD.length-1),e=$.parseJSON(a);$("#mcCampaignList").children().each(function(){$(this).remove()}),$("#mcDiscountList").children().each(function(){$(this).remove()}),$.each(e,function(t,a){var e="<option  value="+a.keyStr+">"+a.valStr+"</option>";$(e).attr("class","tempDDValue"),$(e).appendTo("#mcCampaignList")});var n=t.discountDD.substring(1,t.discountDD.length-1),i=$.parseJSON(n);$.each(i,function(t,a){var e="<option value="+a.keyStr+">"+a.valStr+"</option>";$(e).appendTo("#mcDiscountList")})}},error:function(){$("#content").hide()}})}function activateContentPane(t){var a=$(t).attr("id");$(".tab-pane").removeClass("active"),$(".tabLi").removeClass("active"),$("#"+a+"-content").addClass("active"),$(".tabLink").css("color","#333"),$("#"+a).css("color","#D74536")}function getListSiteDD(){$("#progressIndicator").show(),$.ajax({headers:{"Content-Type":"application/javascript"},url:"getSiteListDD?tenantId="+$("#tenantIdHdn").val(),type:"GET",success:function(t){if("SUCCESS"==t.status){$("#secondTab").show(),$("#thirdTab").show(),$("#fourthTab").show();var a=t.listDD,e=t.siteDD;$("#listMapConfDiv").show(),$("#mapListId1").children().each(function(){$(this).remove()}),$("#mapSiteId1").children().each(function(){$(this).remove()}),$.each(a,function(t,a){var e="<option value="+a.id+">"+a.value+"</option>";$(e).appendTo("#mapListId1")}),$.each(e,function(t,a){var e="<option value="+a.siteId+">"+a.siteName+"</option>";$(e).appendTo("#mapSiteId1")}),$("#progressIndicator").hide()}else $("#discountSaveError").show()},error:function(){$("#content").hide()}})}function rescheduleBatch(){$.ajax({headers:{"Content-Type":"application/javascript"},url:"reScheduleBatch?resschedulePrm="+$("#tenantIdHdn").val()+":"+$("#mcDirectionDD").val(),type:"POST",success:function(t){"SUCCESS"==t&&$("#thirdTab").click()},error:function(){$("#content").hide()}})}function getMappedData(){$("#progressIndicator").show(),$.ajax({headers:{"Content-Type":"application/javascript"},url:"getMappedData?tenantId="+$("#tenantIdHdn").val(),type:"GET",success:function(t){if("SUCCESS"==t.status){var a=t.returnData;$(".tempMapped").each(function(){$(this).remove()}),$.each(a,function(t,a){$("#headerMapping").show();var e=$("<tr/>");e.attr("class","tempMapped");var n=$("<td/>"),i=$("<p/>");n.attr("class","tdClass"),$(i).html(a.listName),$(n).append(i),$(e).append(n);var s=$("<td/>"),c=$("<p/>");s.attr("class","tdClass"),$(c).html(a.siteName),$(s).append(c),$(e).append(s);var o=$("<td/>"),p=$("<img/>");$(p).attr("src","images/icon_remove.png");var r=$("<a/>");o.attr("class","tdClass"),$(r).attr("id",a.siteId),$(r).css("cursor","pointer"),$(r).append(p),$(o).append(r),$(r).attr("onclick","javascript:deleteMapping("+a.siteId+")"),$(e).append(o),$("#siteMapBody").append(e)})}else $("#mappedData").show()},error:function(){$("#content").hide()}})}function deleteMapping(t){$.ajax({headers:{"Content-Type":"application/javascript"},url:"deleteMapping?deletePrm="+$("#tenantIdHdn").val()+":"+t,type:"GET",success:function(t){if("SUCCESS"==t.status){{t.returnData}getMappedData()}else $("#mappedData").show()},error:function(){$("#content").hide()}})}